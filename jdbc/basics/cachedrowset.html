<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
    

<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>使用 CachedRowSet 对象(Java™ 教程-Java Tutorials 中文版&gt;JDBC(TM) 数据库访问&gt;JDBC 基础知识)
</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
     <meta name="description" content="This JDBC Java tutorial describes how to use JDBC API to create, insert into, update, and query tables. You will also learn how to use simple and prepared statements, stored procedures and perform transactions" />
     <meta name="keywords" content="java programming, learn java, java sample code, jdbc, prepared statement, result set" />
        
<style type="text/css">
    body {
        margin-left:10px;
        margin-right:10px;
        line-height: 1.5;
        FONT-FAMILY: Arial, Helvetica, sans-serif; 
        font-size: 0.8em;
    }
    
    a:link{text-decoration:none; color:#09569d;}
    a:visited{text-decoration:none; color: #3a87cf;}
    a:hover{text-decoration:underline; }
        
    code{
        font-family:Monaco,Courier,"Courier New";
    }
    
    .header-container {
        background-color: #fff;
        border-bottom: 1px solid #C1CFDA;
        -webkit-box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
        box-shadow: 0 2px 2px rgba(117, 163, 231, 0.1);
    }
    
    .bookwrapper {
        width: auto;
        margin: auto;
    }
    
    .clearfix {
    }
    
    .clearfloat {
        clear: both;
        overflow: auto;
        height: 0px;
        font-size: 1px;
        line-height: 0px;
    }
    
    #brandProdName {
        width: auto;
        height: auto;
    }
    
    #logocover {
        display: block;
        background: transparent url(../../images/oracle-java-logo.png) 0px 0px no-repeat;
        height: 50px;
        width: 229px;
        float: left;
    }
    
    #productName {
        font-size: 16px;
        position: relative;
        top: 19px;
        padding-left: 3px;
        color: #457798;
        white-space: nowrap;
        width: 340px;
    }


    .FigureCaption   { 
        font-family: sans-serif; 
        text-align: center;
    }
    
    #TopBar_bl {        
        width: 100%;
        height: 60px;
    }
    #TopBar_br {
        width: 100%;
        height: 60px;
    }
    #TopBar_tl {
        margin-left: -110px;
        margin-right: -100px;       
		align: left;
        height: 60px;
    }
    #TopBar_tr {
        width: 100%;
        height: 60px;
    }
    
    #TopBar {
        min-width:700px;
        padding:25px 100px 10px;
        margin-bottom:25px;
        clear:both;
        
        border-bottom:1px solid #d2dde5;
        border-radius: 3px;
    
        background:#efefef; /* Old browsers */
        /* IE9 SVG, needs conditional override of 'filter' to 'none' */
        background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiA/Pgo8c3ZnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgdmlld0JveD0iMCAwIDEgMSIgcHJlc2VydmVBc3BlY3RSYXRpbz0ibm9uZSI+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJncmFkLXVjZ2ctZ2VuZXJhdGVkIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgeDE9IjAlIiB5MT0iMCUiIHgyPSIwJSIgeTI9IjEwMCUiPgogICAgPHN0b3Agb2Zmc2V0PSIwJSIgc3RvcC1jb2xvcj0iI2ZmZmZmZiIgc3RvcC1vcGFjaXR5PSIxIi8+CiAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0b3AtY29sb3I9IiNlMmVmZjkiIHN0b3Atb3BhY2l0eT0iMSIvPgogIDwvbGluZWFyR3JhZGllbnQ+CiAgPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0idXJsKCNncmFkLXVjZ2ctZ2VuZXJhdGVkKSIgLz4KPC9zdmc+);
        background: -moz-linear-gradient(top,  #ffffff 0%, #e2eff9 100%); /* FF3.6+ */
        background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,#ffffff), color-stop(100%,#e2eff9)); /* Chrome,Safari4+ */
        background: -webkit-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Chrome10+,Safari5.1+ */
        background: -o-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* Opera 11.10+ */
        background: -ms-linear-gradient(top,  #ffffff 0%,#e2eff9 100%); /* IE10+ */
        background: linear-gradient(to bottom,  #ffffff 0%,#e2eff9 100%); /* W3C */
        filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#e2eff9',GradientType=0 ); /* IE6-8 */
        
    }
    
    #TopBar_left {
        line-height: 14px;
        position: absolute;
        padding-top: 30px;
        padding-right: 30px;
        padding-left: 30px;
        text-align: left;
        font: 13px/20px Arial, Helvetica, sans-serif;
        font-weight: bold;
        font-size: 20px;
        color: #333;
    }
    
    #TopBar_right {
        line-height: 12px;
        float: right;
        padding-top: 10px;
        padding-right: 30px;
        text-align: left;
    }
    

    @media print {
        #BreadCrumbs, #Download {
            display: none;
        }
    }
    
     
    @media print {
        #TopBar_right {
            display: none;
        }
    }
    #TopBar_right a {
        font-size: 10px;
        margin: 3px;
        padding: 0;
    }
 
    #BreadCrumbs {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
        float: right;
    }
    
    #BreadCrumbs a {
        color:#09569d;
    }
    
    #BreadCrumbs a:visited, #BreadCrumbs a:link {
        text-decoration: none;
    }
    
    #BreadCrumbs a:hover, #BreadCrumbs a:active {
        text-decoration: underline;
    }
    
    #PageTitle {
        margin: 0 5px 0.5em 0;
        color: #F90000;
    }
    
    #PageContent{
        margin: 0 5px 0 20px;
    }
    
    .LeftBar_shown {
        width: 13em;
        float: left;
    }
    
    @media print {
        .LeftBar_shown {
            display: none;
        }
    }
    
    .LeftBar_hidden {
        display: none;
    }
    
    #Footer {
        padding-top: 10px;
        padding-left: 10px;
        margin-right: 10px;       
    }
    
    .footertext {
        font-size: 10px;
        font-family: sans-serif; 
        margin-top: 1px;
    }

    .NavBit  {
        padding: 15px 5px 0.5em 0;
        font-family: sans-serif; 
    }
    
    @media print {
        .NavBit {
            display: none;
        }
    }
    
    #TagNotes {
        text-align: right;        
    }
    
    @media print {
        #TagNotes a:visited, #TagNotes a:link {
            color: #35556B;
            text-decoration: none;
        }
    }
    
    #Contents a, .NavBit a, #TagNotes a {
        color:#09569d;
    }
    
    #TagNotes a:visited, #TagNotes a:link,
    #Contents a:visited, #Contents a:link,
    .NavBit a:visited, .NavBit a:link {
        text-decoration: none;
    }
    
    #TagNotes a:hover, #TagNotes a:active,   
    #Contents a:hover, #Contents a:active,   
    .NavBit a:hover, .NavBit a:active {  
        text-decoration: underline;
    }
    
    #Contents {
        float: left;
        font-family: sans-serif; 
    }
    @media print {
        #Contents {
            display: none;
        }
    }
    @media screen {
        div.PrintHeaders {
            display: none;
        }
    }
    .linkLESSON, .nolinkLESSON {
        margin-left: 0.5em;
        text-indent: -0.5em;
    }
    .linkAHEAD, .nolinkAHEAD, .linkQUESTIONS, .nolinkQUESTIONS   {
        margin-left: 1.5em; 
        text-indent: -0.5em
    }
    .linkBHEAD, .nolinkBHEAD   {
        margin-left: 2.5em;
        text-indent: -0.5em
    }
    .linkCHEAD, .nolinkCHEAD   {
        margin-left: 3.5em;
        text-indent: -0.5em
    }
    .nolinkLESSON, .nolinkAHEAD, .nolinkBHEAD, .nolinkCHEAD,
    .nolinkQUESTIONS {
        font-weight: bold;
        color: #333;
		
		
    }
    .MainFlow_indented {
        margin-right: 10px;
        margin-left: 15em;
        margin-bottom: 2em;

    }
    .MainFlow_wide {
	
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 2em;

    }
    @media print {
        .MainFlow_indented, .MainFlow_wide {
            padding-top: 0;
            margin-top: 10px;
            margin-right: 10px;
            margin-left: 0;
        }
    }
    h1, h2, h3, h4, h5 {
        color: #333;
        
    }

    h1 {
        font-weight: bold;
        font-size: 20px;
    }

    h2 {
        font-weight: bold;
        font-size: 17px;
    }

    h3 {
        font-weight: bold;
        font-size: 14px;
    }

    h4 {
        font-size: 15px;
    }

    h5 {
        font-size: 12px;
    }


    #ToggleLeft {
        display: none;
    }
    
    .note {
        margin: 0 30px 0px 30px;
    }
    
    .codeblock {
        margin: 0 30px 0px 30px;
		font-size:12px;
		font-family:Monaco,Courier,"Courier New";
    }
    
    .tocli {
        list-style-type:none;
    }

    .betadraft {
        color: red;
    }

</style>
<script type="text/javascript">
/* <![CDATA[ */
    function leftBar() {
        var nameq = 'tutorial_showLeftBar='
        var cookies = document.cookie.split(';');
        for (var i = 0; i < cookies.length; i++) {
            var cookieString = cookies[i];
            while (cookieString.charAt(0) == ' ') {
                cookieString = cookieString.substring(1, cookieString.length);
            }
            if (cookieString.indexOf(nameq) == 0) {
                cookieValue =  cookieString.substring(nameq.length,
                        cookieString.length);
                return cookieValue == 'yes';
            }
        }
        return true;
    }

    function showLeft(b) {
        var contents = document.getElementById("LeftBar");
        var main = document.getElementById("MainFlow");
        var toggle = document.getElementById("ToggleLeft");
        if (b) {
            contents.className = "LeftBar_shown";
            main.className = "MainFlow_indented";
            toggle.innerHTML = "Hide TOC";
            document.cookie = 'tutorial_showLeftBar=yes; path=/';
        } else {
            contents.className = "LeftBar_hidden";
            main.className = "MainFlow_wide";
            toggle.innerHTML = "Show the TOC";
            document.cookie = 'tutorial_showLeftBar=no; path=/';
        }
    }

    function toggleLeft() {
        showLeft(document.getElementById("LeftBar").className ==
                "LeftBar_hidden");
        document.getElementById("ToggleLeft").blur();
    }

    function load() {
        showLeft(leftBar());
        document.getElementById("ToggleLeft").style.display="inline";
    }

    function showCode(displayCodePage, codePath) {
        var codePathEls = codePath.split("/");
        var currDocPathEls = location.href.split("/");
        //alert ("codePathEls = " + codePathEls + "\n" + "currDocPathEls = " + currDocPathEls);
        currDocPathEls.pop(); // remove file name at the end
        while (codePathEls.length > 0) {
            if (codePathEls[0] == "..") {
                codePathEls.shift();
                currDocPathEls.pop();
            } else {
                break;
            }
        }
        var fullCodePath = currDocPathEls.join("/") + "/" + codePathEls.join("/");
        //alert ("fullCodePath = " + fullCodePath );
        if (codePath.indexOf(".java") != -1 || codePath.indexOf(".jnlp") != -1) {
            window.location.href = displayCodePage + "?code=" + encodeURI(fullCodePath);
        } else {
            window.location.href = fullCodePath;
        }
    }
/* ]]> */    
</script>


    </head>
<body onload="load()">
    <noscript>
        这个页面需要一个启用 JavaScript 的浏览器才能正常运行。
    </noscript>
        <!-- header -->
    <div class="header-container">
        <div class="bookwrapper  clearfix">       
            <div id="brandProdName">
                <div id="logocover"></div>
                <div id="productName" >文档</div>
            </div> 
            <br class="clearfloat" />
        </div>
    </div>
    
    <div id="TopBar">
        <div id="TopBar_tr">
            <div id="TopBar_tl">
                <div id="TopBar_br"> <div id="TopBar_bl"> 
                    <div id="TopBar_left">Java™ 教程-Java Tutorials 中文版</div>
                        <div id="TopBar_right"><!--
                            <a href="URL" target="_blank">External Link</a><br/>
                            --> 
                             
                            <a href="javascript:toggleLeft()" id="ToggleLeft">隐藏目录</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div id="LeftBar" class="LeftBar_shown">
        <div id="Contents">
            <div class="linkLESSON"><a href="index.html">JDBC 基础知识</a></div>
<div class="linkAHEAD"><a href="gettingstarted.html">入门</a></div>
<div class="linkAHEAD"><a href="processingsqlstatements.html">使用 JDBC 处理 SQL 语句</a></div>
<div class="linkAHEAD"><a href="connecting.html">建立连接</a></div>
<div class="linkAHEAD"><a href="sqldatasources.html">连接 DataSource 对象</a></div>
<div class="linkAHEAD"><a href="sqlexception.html">处理 SQLExceptions</a></div>
<div class="linkAHEAD"><a href="tables.html">设置表</a></div>
<div class="linkAHEAD"><a href="retrieving.html">从结果集中获取和修改值</a></div>
<div class="linkAHEAD"><a href="prepared.html">使用准备好的语句</a></div>
<div class="linkAHEAD"><a href="transactions.html">使用事务</a></div>
<div class="linkAHEAD"><a href="rowset.html">使用 RowSet 对象</a></div>
<div class="linkAHEAD"><a href="jdbcrowset.html">使用 JdbcRowSet 对象</a></div>
<div class="nolinkAHEAD">使用 CachedRowSet 对象</div>
<div class="linkAHEAD"><a href="joinrowset.html">使用 JoinRowSet 对象</a></div>
<div class="linkAHEAD"><a href="filteredrowset.html">使用 FilteredRowSet 对象</a></div>
<div class="linkAHEAD"><a href="webrowset.html">使用 WebRowSet 对象</a></div>
<div class="linkAHEAD"><a href="sqltypes.html">使用高级数据类型</a></div>
<div class="linkAHEAD"><a href="blob.html">使用大对象</a></div>
<div class="linkAHEAD"><a href="sqlxml.html">使用 SQLXML 对象</a></div>
<div class="linkAHEAD"><a href="array.html">使用数组对象</a></div>
<div class="linkAHEAD"><a href="distinct.html">使用 DISTINCT 数据类型</a></div>
<div class="linkAHEAD"><a href="sqlstructured.html">使用结构化对象</a></div>
<div class="linkAHEAD"><a href="sqlcustommapping.html">使用自定义类型映射</a></div>
<div class="linkAHEAD"><a href="sqldatalink.html">使用数据链接对象</a></div>
<div class="linkAHEAD"><a href="sqlrowid.html">使用 RowId 对象</a></div>
<div class="linkAHEAD"><a href="storedprocedures.html">使用存储过程</a></div>
<div class="linkAHEAD"><a href="jdbcswing.html">将 JDBC 与 GUI API 结合使用</a></div>
</div>
    </div>
    <div id="MainFlow" class="MainFlow_indented">
    <div class="PrintHeaders">
        <b>Trail:</b> JDBC(TM) Database Access
        <br /><b>Lesson:</b> JDBC Basics
    </div>
            <div id="BreadCrumbs">
                <a href="../../index.html" target="_top">主页</a>&gt;<a href="../index.html" target="_top">JDBC(TM) 数据库访问</a>&gt;<a href="index.html" target="_top">JDBC 基础知识</a>
            </div>
            <div class="NavBit">
                <a target="_top" href="jdbcrowset.html">«&nbsp;上一页</a>&nbsp;•&nbsp;<a target="_top" href="../TOC.html">路径</a>&nbsp;•&nbsp;<a target="_top" href="joinrowset.html">下一页&nbsp;»</a>
            </div>
            <div class="Banner"><p style="background-color: rgb(247, 248, 249); border-width: 1px; padding: 10px; font-style: italic; border-style: solid; border-color: rgb(64, 74, 91);">Java 教程是为 JDK 8 编写的。本页中描述的示例和实践未利用在后续版本中引入的改进。</p></div>
            <div id="PageTitle"><h1>使用 CachedRowSet 对象</h1></div>
            <div id="PageContent">

<p>A <code>CachedRowSet</code> object is special in that it can operate without being connected to its data source, that is, it is a <i>disconnected</i> <code>RowSet</code> object. It gets its name from the fact that it stores (caches) its data in memory so that it can operate on its own data rather than on the data stored in a database.</p>
<p>The <code>CachedRowSet</code> interface is the superinterface for all disconnected <code>RowSet</code> objects, so everything demonstrated here also applies to <code>WebRowSet</code>, <code>JoinRowSet</code>, and <code>FilteredRowSet</code> objects.</p>
<p>Note that although the data source for a <code>CachedRowSet</code> object (and the <code>RowSet</code> objects derived from it) is almost always a relational database, a <code>CachedRowSet</code> object is capable of getting data from any data source that stores its data in a tabular format. For example, a flat file or spreadsheet could be the source of data. This is true when the <code>RowSetReader</code> object for a disconnected <code>RowSet</code> object is implemented to read data from such a data source. The reference implementation of the <code>CachedRowSet</code> interface has a <code>RowSetReader</code> object that reads data from a relational database, so in this tutorial, the data source is always a database.</p>
<p>涵盖以下主题：</p>
<ul>
<li><a href="#setting-up-cachedrowset-object">Setting Up CachedRowSet Objects</a></li>
<li><a href="#populating-cachedrowset-object">Populating CachedRowSet Objects</a></li>
<li><a href="#reader">What Reader Does</a></li>
<li><a href="#updating-cachedrowset-object">Updating CachedRowSet Objects</a></li>
<li><a href="#updating-data-source">Updating Data Sources</a></li>
<li><a href="#writer">What Writer Does</a></li>
<li><a href="#notifying-listeners">Notifying Listeners</a></li>
<li><a href="#sending-large-amounts-of-data">Sending Large Amounts of Data</a></li>
</ul><!-- ****************************************** -->

<h2><a name="setting-up-cachedrowset-object" id="setting-up-cachedrowset-object">Setting Up CachedRowSet Objects</a></h2>
<p>Setting up a <code>CachedRowSet</code> object involves the following:</p>
<ul>
<li><a href="#creating-cachedrowset-object">Creating CachedRowSet Objects</a></li>
<li><a href="#setting-cachedrowset-properties">Setting CachedRowSet Properties</a></li>
<li><a href="#setting-key-columns">Setting Key Columns</a></li>
</ul><!-- ****************************************** -->

<h3><a name="creating-cachedrowset-object" id="creating-cachedrowset-object">Creating CachedRowSet Objects</a></h3>
<p>You can create a new <code>CachedRowSet</code> object in the different ways:</p>
<ul>
<li><a href="#using-default-constructor">Using the Default Constructor</a></li>
<li>Using an instance of <code>RowSetFactory</code>, which is created from the class <code>RowSetProvider</code>: See <a href="jdbcrowset.html#rowsetfactory">Using the RowSetFactory Interface</a> in <a href="jdbcrowset.html">Using JdbcRowSet Objects</a> for more information.</li>
</ul>
<p><strong>注意</strong>:Alternatively, you can use the constructor from the <code>CachedRowSet</code> implementation of your JDBC driver. However, implementations of the <code>RowSet</code> interface will differ from the reference implementation. These implementations will have different names and constructors. For example, the Oracle JDBC driver's implementation of the <code>CachedRowSet</code> interface is named <code>oracle.jdbc.rowset.OracleCachedRowSet</code>.</p><!-- ****************************************** -->

<h4><a name="using-default-constructor" id="using-default-constructor">Using the Default Constructor</a></h4>
<p>One of the ways you can create a <code>CachedRowSet</code> object is by calling the default constructor defined in the reference implementation, as is done in the following line of code:</p>
<div class="codeblock"><pre>
CachedRowSet crs = new CachedRowSetImpl();
</pre></div>
<p>The object <code>crs</code> has the same default values for its properties that a <code>JdbcRowSet</code> object has when it is first created. In addition, it has been assigned an instance of the default <code>SyncProvider</code> implementation, <code>RIOptimisticProvider</code>.</p>
<p>A <code>SyncProvider</code> object supplies a <code>RowSetReader</code> object (a <i>reader</i>) and a <code>RowSetWriter</code> object (a <i>writer</i>), which a disconnected <code>RowSet</code> object needs in order to read data from its data source or to write data back to its data source. What a reader and writer do is explained later in the sections <a href="#reader">What Reader Does</a> and <a href="#writer">What Writer Does</a>. One thing to keep in mind is that readers and writers work entirely in the background, so the explanation of how they work is for your information only. Having some background on readers and writers should help you understand what some of the methods defined in the <code>CachedRowSet</code> interface do in the background.</p>
<h3><a name="setting-cachedrowset-properties" id="setting-cachedrowset-properties">Setting CachedRowSet Properties</a></h3>
<p>Generally, the default values for properties are fine as they are, but you may change the value of a property by calling the appropriate setter method. There are some properties without default values that you must set yourself.</p>
<p>In order to get data, a disconnected <code>RowSet</code> object must be able to connect to a data source and have some means of selecting the data it is to hold. The following properties hold information necessary to obtain a connection to a database.</p>
<ul>
<li><code>username</code>: The name a user supplies to a database as part of gaining access</li>
<li><code>password</code>: The user's database password</li>
<li><code>url</code>: The JDBC URL for the database to which the user wants to connect</li>
<li><code>datasourceName</code>: The name used to retrieve a DataSource object that has been registered with a JNDI naming service</li>
</ul>
<p>Which of these properties you must set depends on how you are going to make a connection. The preferred way is to use a <code>DataSource</code> object, but it may not be practical for you to register a <code>DataSource</code> object with a JNDI naming service, which is generally done by a system administrator. Therefore, the code examples all use the <code>DriverManager</code> mechanism to obtain a connection, for which you use the <code>url</code> property and not the <code>datasourceName</code> property.</p>
<p>The following lines of code set the <code>username</code>, <code>password</code>, and <code>url</code> properties so that a connection can be obtained using the <code>DriverManager</code> class. (You will find the JDBC URL to set as the value for the <code>url</code> property in the documentation for your JDBC driver.)</p>
<div class="codeblock"><pre>
public void setConnectionProperties(
    String username, String password) {
    crs.setUsername(username);
    crs.setPassword(password);
    crs.setUrl("jdbc:mySubprotocol:mySubname");
    // ...
</pre></div>
<p>Another property that you must set is the <code>command</code> property. In the reference implementation, data is read into a <code>RowSet</code> object from a <code>ResultSet</code> object. The query that produces that <code>ResultSet</code> object is the value for the <code>command</code> property. For example, the following line of code sets the <code>command</code> property with a query that produces a <code>ResultSet</code> object containing all the data in the table <code>MERCH_INVENTORY</code>:</p>
<div class="codeblock"><pre>
crs.setCommand("select * from MERCH_INVENTORY");
</pre></div><!-- ****************************************** -->

<h3><a name="setting-key-columns" id="setting-key-columns">Setting Key Columns</a></h3>
<p>If you are going make any updates to the <code>crs</code> object and want those updates saved in the database, you must set one more piece of information: the key columns. Key columns are essentially the same as a primary key because they indicate one or more columns that uniquely identify a row. The difference is that a primary key is set on a table in the database, whereas key columns are set on a particular <code>RowSet</code> object. The following lines of code set the key columns for <code>crs</code> to the first column:</p>
<div class="codeblock"><pre>
int [] keys = {1};
crs.setKeyColumns(keys);
</pre></div>
<p>The first column in the table <code>MERCH_INVENTORY</code> is <code>ITEM_ID</code>. It can serve as the key column because every item identifier is different and therefore uniquely identifies one row and only one row in the table <code>MERCH_INVENTORY</code>. In addition, this column is specified as a primary key in the definition of the <code>MERCH_INVENTORY</code> table. The method <code>setKeyColumns</code> takes an array to allow for the fact that it may take two or more columns to identify a row uniquely.</p>
<p>As a point of interest, the method <code>setKeyColumns</code> does not set a value for a property. In this case, it sets the value for the field <code>keyCols</code>. Key columns are used internally, so after setting them, you do nothing more with them. You will see how and when key columns are used in the section <a href="#syncresolver">Using SyncResolver Objects</a>.</p><!-- ****************************************** -->

<h2><a name="populating-cachedrowset-object" id="populating-cachedrowset-object">Populating CachedRowSet Objects</a></h2>
<p>Populating a disconnected <code>RowSet</code> object involves more work than populating a connected <code>RowSet</code> object. Fortunately, the extra work is done in the background. After you have done the preliminary work to set up the <code>CachedRowSet</code> object <code>crs</code>, the following line of code populates <code>crs</code>:</p>
<div class="codeblock"><pre>
crs.execute();
</pre></div>
<p>The data in <code>crs</code> is the data in the <code>ResultSet</code> object produced by executing the query in the command property.</p>
<p>What is different is that the <code>CachedRowSet</code> implementation for the <code>execute</code> method does a lot more than the <code>JdbcRowSet</code> implementation. Or more correctly, the <code>CachedRowSet</code> object's reader, to which the method execute delegates its tasks, does a lot more.</p>
<p>Every disconnected <code>RowSet</code> object has a <code>SyncProvider</code> object assigned to it, and this <code>SyncProvider</code> object is what provides the <code>RowSet</code> object's <em>reader</em> (a <code>RowSetReader</code> object). When the <code>crs</code> object was created, it was used as the default <code>CachedRowSetImpl</code> constructor, which, in addition to setting default values for properties, assigns an instance of the <code>RIOptimisticProvider</code> implementation as the default <code>SyncProvider</code> object.</p><!-- ****************************************** -->

<h2><a name="reader" id="reader">What Reader Does</a></h2>
<p>When an application calls the method <code>execute</code>, a disconnected <code>RowSet</code> object's reader works behind the scenes to populate the <code>RowSet</code> object with data. A newly created <code>CachedRowSet</code> object is not connected to a data source and therefore must obtain a connection to that data source in order to get data from it. The reference implementation of the default <code>SyncProvider</code> object (<code>RIOptimisticProvider</code>) provides a reader that obtains a connection by using the values set for the user name, password, and either the JDBC URL or the data source name, whichever was set more recently. Then the reader executes the query set for the command. It reads the data in the <code>ResultSet</code> object produced by the query, populating the <code>CachedRowSet</code> object with that data. Finally, the reader closes the connection.</p><!-- ****************************************** -->

<h2><a name="updating-cachedrowset-object" id="updating-cachedrowset-object">Updating CachedRowSet Object</a></h2>
<p>In the Coffee Break scenario, the owner wants to streamline operations. The owner decides to have employees at the warehouse enter inventory directly into a PDA (personal digital assistant), thereby avoiding the error-prone process of having a second person do the data entry. A <code>CachedRowSet</code> object is ideal in this situation because it is lightweight, serializable, and can be updated without a connection to the data source.</p>
<p>The owner will have the application development team create a GUI tool for the PDA that warehouse employees will use for entering inventory data. Headquarters will create a <code>CachedRowSet</code> object populated with the table showing the current inventory and send it using the Internet to the PDAs. When a warehouse employee enters data using the GUI tool, the tool adds each entry to an array, which the <code>CachedRowSet</code> object will use to perform the updates in the background. Upon completion of the inventory, the PDAs send their new data back to headquarters, where the data is uploaded to the main server.</p>
<p>本节包括以下主题：</p>
<ul>
<li><a href="#updating-column-value">Updating Column Values</a></li>
<li><a href="#inserting-and-deleting-rows">Inserting and Deleting Rows</a></li>
</ul><!-- ****************************************** -->

<h3><a name="updating-column-value" id="updating-column-value">Updating Column Values</a></h3>
<p>Updating data in a <code>CachedRowSet</code> object is just the same as updating data in a <code>JdbcRowSet</code> object. For example, the following code fragment from <code><a href="gettingstarted.html">CachedRowSetSample.java</a></code> increments the value in the column <code>QUAN</code> by 1 in the row whose <code>ITEM_ID</code> column has an item identifier of <code>12345</code>:</p>
<div class="codeblock"><pre>
while (crs.next()) {
    System.out.println(
        "Found item " + crs.getInt("ITEM_ID") +
        ": " + crs.getString("ITEM_NAME"));
    if (crs.getInt("ITEM_ID") == 1235) {
        int currentQuantity = crs.getInt("QUAN") + 1;
        System.out.println("Updating quantity to " +
          currentQuantity);
        crs.updateInt("QUAN", currentQuantity + 1);
        crs.updateRow();
        // Synchronizing the row
        // back to the DB
        crs.acceptChanges(con);
    }
</pre></div><!-- ****************************************** -->

<h3><a name="inserting-and-deleting-rows" id="inserting-and-deleting-rows">Inserting and Deleting Rows</a></h3>
<p>Just as with updating a column value, the code for inserting and deleting rows in a <code>CachedRowSet</code> object is the same as for a <code>JdbcRowSet</code> object.</p>
<p>The following excerpt from <code><a href="gettingstarted.html">CachedRowSetSample.java</a></code> inserts a new row into the <code>CachedRowSet</code> object <code>crs</code>:</p>
<div class="codeblock"><pre>
crs.moveToInsertRow();
crs.updateInt("ITEM_ID", newItemId);
crs.updateString("ITEM_NAME", "TableCloth");
crs.updateInt("SUP_ID", 927);
crs.updateInt("QUAN", 14);
Calendar timeStamp;
timeStamp = new GregorianCalendar();
timeStamp.set(2006, 4, 1);
crs.updateTimestamp(
    "DATE_VAL",
    new Timestamp(timeStamp.getTimeInMillis()));
crs.insertRow();
crs.moveToCurrentRow();
</pre></div>
<p>If headquarters has decided to stop stocking a particular item, it would probably remove the row for that coffee itself. However, in the scenario, a warehouse employee using a PDA also has the capability of removing it. The following code fragment finds the row where the value in the <code>ITEM_ID</code> column is <code>12345</code> and deletes it from the <code>CachedRowSet</code> <code>crs</code>:</p>
<div class="codeblock"><pre>
while (crs.next()) {
    if (crs.getInt("ITEM_ID") == 12345) {
        crs.deleteRow();
        break;
    }
}
</pre></div><!-- ****************************************** -->

<h2><a name="updating-data-source" id="updating-data-source">Updating Data Sources</a></h2>
<p>There is a major difference between making changes to a <code>JdbcRowSet</code> object and making changes to a <code>CachedRowSet</code> object. Because a <code>JdbcRowSet</code> object is connected to its data source, the methods <code>updateRow</code>, <code>insertRow</code>, and <code>deleteRow</code> can update both the <code>JdbcRowSet</code> object and the data source. In the case of a disconnected <code>RowSet</code> object, however, these methods update the data stored in the <code>CachedRowSet</code> object's memory but cannot affect the data source. A disconnected <code>RowSet</code> object must call the method <code>acceptChanges</code> in order to save its changes to the data source. In the inventory scenario, back at headquarters, an application will call the method <code>acceptChanges</code> to update the database with the new values for the column <code>QUAN</code>.</p>
<div class="codeblock"><pre>
crs.acceptChanges();
</pre></div><!-- ****************************************** -->

<h2><a name="writer" id="writer">What Writer Does</a></h2>
<p>Like the method <code>execute</code>, the method <code>acceptChanges</code> does its work invisibly. Whereas the method <code>execute</code> delegates its work to the <code>RowSet</code> object's reader, the method <code>acceptChanges</code> delegates its tasks to the <code>RowSet</code> object's writer. In the background, the writer opens a connection to the database, updates the database with the changes made to the <code>RowSet</code> object, and then closes the connection.</p><!-- ****************************************** -->

<h3>Using Default Implementation</h3>
<p>The difficulty is that a <i>conflict</i> can arise. A conflict is a situation in which another party has updated a value in the database that corresponds to a value that was updated in a <code>RowSet</code> object. Which value should persist in the database? What the writer does when there is a conflict depends on how it is implemented, and there are many possibilities. At one end of the spectrum, the writer does not even check for conflicts and just writes all changes to the database. This is the case with the <code>RIXMLProvider</code> implementation, which is used by a <code>WebRowSet</code> object. At the other end, the writer ensures that there are no conflicts by setting database locks that prevent others from making changes.</p>
<p>The writer for the <code>crs</code> object is the one provided by the default <code>SyncProvider</code> implementation, <code>RIOptimisticProvider</code>. The <code>RIOPtimisticProvider</code> implementation gets its name from the fact that it uses an optimistic concurrency model. This model assumes that there will be few, if any, conflicts and therefore sets no database locks. The writer checks to see if there are any conflicts, and if there is none, it writes the changes made to the <code>crs</code> object to the database, and those changes become persistent. If there are any conflicts, the default is not to write the new <code>RowSet</code> values to the database.</p>
<p>In the scenario, the default behavior works very well. Because no one at headquarters is likely to change the value in the <code>QUAN</code> column of <code>COF_INVENTORY</code>, there will be no conflicts. As a result, the values entered into the <code>crs</code> object at the warehouse will be written to the database and thus will be persistent, which is the desired outcome.</p>
<h2><a name="syncresolver" id="syncresolver">Using SyncResolver Objects</a></h2>
<p>In other situations, however, it is possible for conflicts to exist. To accommodate these situations, the <code>RIOPtimisticProvider</code> implementation provides an option that lets you look at the values in conflict and decide which ones should be persistent. This option is the use of a <code>SyncResolver</code> object.</p>
<p>When the writer has finished looking for conflicts and has found one or more, it creates a <code>SyncResolver</code> object containing the database values that caused the conflicts. Next, the method <code>acceptChanges</code> throws a <code>SyncProviderException</code> object, which an application may catch and use to retrieve the <code>SyncResolver</code> object. The following lines of code retrieve the <code>SyncResolver</code> object <code>resolver</code>:</p>
<div class="codeblock"><pre>
try {
    crs.acceptChanges();
} catch (SyncProviderException spe) {
    SyncResolver resolver = spe.getSyncResolver();
}
</pre></div>
<p>The object <code>resolver</code> is a <code>RowSet</code> object that replicates the <code>crs</code> object except that it contains only the values in the database that caused a conflict. All other column values are null.</p>
<p>With the <code>resolver</code> object, you can iterate through its rows to locate the values that are not null and are therefore values that caused a conflict. Then you can locate the value at the same position in the <code>crs</code> object and compare them. The following code fragment retrieves <code>resolver</code> and uses the <code>SyncResolver</code> method <code>nextConflict</code> to iterate through the rows that have conflicting values. The object <code>resolver</code> gets the status of each conflicting value, and if it is <code>UPDATE_ROW_CONFLICT</code>, meaning that the <code>crs</code> was attempting an update when the conflict occurred, the <code>resolver</code> object gets the row number of that value. Then the code moves the cursor for the <code>crs</code> object to the same row. Next, the code finds the column in that row of the <code>resolver</code> object that contains a conflicting value, which will be a value that is not null. After retrieving the value in that column from both the <code>resolver</code> and <code>crs</code> objects, you can compare the two and decide which one you want to become persistent. Finally, the code sets that value in both the <code>crs</code> object and the database using the method <code>setResolvedValue</code>, as shown in the following code:</p>
<div class="codeblock"><pre>
try {
    crs.acceptChanges();
} catch (SyncProviderException spe) {
    SyncResolver resolver = spe.getSyncResolver();
  
    // value in crs
    Object crsValue;
  
    // value in the SyncResolver object
    Object resolverValue; 
  
    // value to be persistent
    Object resolvedValue; 

    while (resolver.nextConflict()) {
        if (resolver.getStatus() ==
            SyncResolver.UPDATE_ROW_CONFLICT) {
            int row = resolver.getRow();
            crs.absolute(row);
            int colCount =
                crs.getMetaData().getColumnCount();
            for (int j = 1; j &lt;= colCount; j++) {
                if (resolver.getConflictValue(j)
                    != null) {
                    crsValue = crs.getObject(j);
                    resolverValue = 
                        resolver.getConflictValue(j);

                    // ...
                    // compare crsValue and
                    // resolverValue to
                    // determine the value to be
                    // persistent

                    resolvedValue = crsValue;
                    resolver.setResolvedValue(
                        j, resolvedValue);
                }
            }
        }
    }
}
</pre></div><!-- ****************************************** -->

<h2><a name="notifying-listeners" id="notifying-listeners">Notifying Listeners</a></h2>
<p>Being a JavaBeans component means that a <code>RowSet</code> object can notify other components when certain things happen to it. For example, if data in a <code>RowSet</code> object changes, the <code>RowSet</code> object can notify interested parties of that change. The nice thing about this notification mechanism is that, as an application programmer, all you have to do is add or remove the components that will be notified.</p>
<p>本节包括以下主题：</p>
<ul>
<li><a href="#setting-up-listeners">Setting Up Listeners</a></li>
<li><a href="#how-notification-works">How Notification Works</a></li>
</ul><!-- ****************************************** -->

<h3><a name="setting-up-listeners" id="setting-up-listeners">Setting Up Listeners</a></h3>
<p>A <i>listener</i> for a <code>RowSet</code> object is a component that implements the following methods from the <code>RowSetListener</code> interface:</p>
<ul>
<li><code>cursorMoved</code>: Defines what the listener will do, if anything, when the cursor in the <code>RowSet</code> object moves.</li>
<li><code>rowChanged</code>: Defines what the listener will do, if anything, when one or more column values in a row have changed, a row has been inserted, or a row has been deleted.</li>
<li><code>rowSetChanged</code>: Defines what the listener will do, if anything, when the <code>RowSet</code> object has been populated with new data.</li>
</ul>
<p>An example of a component that might want to be a listener is a <code>BarGraph</code> object that graphs the data in a <code>RowSet</code> object. As the data changes, the <code>BarGraph</code> object can update itself to reflect the new data.</p>
<p>As an application programmer, the only thing you must do to take advantage of the notification mechanism is to add or remove listeners. The following line of code means that every time the cursor for the <code>crs</code> objects moves, values in <code>crs</code> are changed, or <code>crs</code> as a whole gets new data, the <code>BarGraph</code> object <code>bar</code> will be notified:</p>
<div class="codeblock"><pre>
crs.addRowSetListener(bar);
</pre></div>
<p>You can also stop notifications by removing a listener, as is done in the following line of code:</p>
<div class="codeblock"><pre>
crs.removeRowSetListener(bar);
</pre></div>
<p>Using the Coffee Break scenario, assume that headquarters checks with the database periodically to get the latest price list for the coffees it sells online. In this case, the listener is the <code>PriceList</code> object <code>priceList</code> at the Coffee Break web site, which must implement the <code>RowSetListener</code> methods <code>cursorMoved</code>, <code>rowChanged</code>, and <code>rowSetChanged</code>. The implementation of the <code>cursorMoved</code> method could be to do nothing because the position of the cursor does not affect the <code>priceList</code> object. The implementations for the <code>rowChanged</code> and <code>rowSetChanged</code> methods, on the other hand, must ascertain what changes have been made and update <code>priceList</code> accordingly.</p>

<h3><a name="how-notification-works" id="how-notification-works">How Notification Works</a></h3>
<p>In the reference implementation, methods that cause any of the <code>RowSet</code> events automatically notify all registered listeners. For example, any method that moves the cursor also calls the method <code>cursorMoved</code> on each of the listeners. Similarly, the method <code>execute</code> calls the method <code>rowSetChanged</code> on all listeners, and <code>acceptChanges</code> calls <code>rowChanged</code> on all listeners.</p><!-- ****************************************** -->

<h2><a name="sending-large-amounts-of-data" id="sending-large-amounts-of-data">Sending Large Amounts of Data</a></h2>
<p>The sample code <a href="gettingstarted.html"><code>CachedRowSetSample.testCachedRowSet</code></a> demonstrates how data can be sent in smaller pieces.</p>


        </div>
        <div class="NavBit">
            <a target="_top" href="jdbcrowset.html">« 上一页</a>•<a target="_top" href="../TOC.html">路径</a>•<a target="_top" href="joinrowset.html">下一页 »</a>
        </div>
    </div>
    
<hr class="clearfloat"/>

<div id="Footer">

<p class="footertext">
<a href="http://www.oracle.com/corporate/index.html">About Oracle</a>| <a href="http://www.oracle.com/us/corporate/contact/index.html">Contact Us</a> | <a href="http://www.oracle.com/us/legal/index.html">Legal Notices</a> | <a href="http://www.oracle.com/us/legal/terms/index.html">Terms of Use</a> | <a href="http://www.oracle.com/us/legal/privacy/index.html">Your Privacy Rights</a> | <a href="https://www.pingfangx.com/xx/translation/java_tutorial">关于汉化</a></p>

<p class="footertext"><a href="http://www.oracle.com/pls/topic/lookup?ctx=cpyr&id=en-US">

Copyright © 1995, 2017 Oracle and/or its affiliates. All rights reserved.</a></p>
       
</div>    
    <div class="PrintHeaders">
        <b>Previous page:</b> Using JdbcRowSet Objects
        <br /><b>Next page:</b> Using JoinRowSet Objects
    </div>
</body>
</html> 
